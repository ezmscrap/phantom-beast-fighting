# 幻獣闘技 SPA 仕様メモ

本ドキュメントは、アプリ内で実装している「幻獣闘技」ボードゲームの主要ルール・画面構成・進行手順を整理したものです。実装時の参照用に短くまとめています。

## 画面構成

- **メインボード**: 6×5 グリッド (A1〜E6)。ユニット配置や移動時にハイライト表示。
- **サイコロ置き場**: R1〜R3 の3スロット。ステップ6で銀→銀→金の順で配置。
- **プレイヤーパネル**: 各プレイヤーの残り兵種、カード枚数、エネルギートークン(T1〜T3) を表示。
- **情報パネル**: 現在の手順(1〜16)と対象プレイヤー、進行ボタン。
- **モーダル**: 先行決定、ユニット作成/配置、アクション選択、ダイス再配置、ユニット入れ替え、ダイス演出など。

## 対戦形式（手順0）

ゲーム開始時は「対戦形式決定手順」を実行し、以下3つのモードから選択する。接続に使用するID（プレイヤーID/観戦ID）はアプリのヘッダー下に表示されるため、別ブラウザと対戦／観戦する場合はメッセージングソフト等を使って互いに ID を共有してから入力する。

| モード | 概要 |
| --- | --- |
| **1ブラウザで対戦** | 従来どおり同一画面で先行/後攻の操作を交互に行う。観戦用IDを発行し、他ブラウザが「観戦」モードで接続するとログのみを共有できる。 |
| **通信で対戦** | PeerJS を利用したP2P通信。接続側のブラウザがプレイヤーA、接続を受ける側がプレイヤーBとなる。手番外はUIがロックされ、相手の操作ログが届くまで待機する。 |
| **対戦を観戦** | 観戦専用モード。1ブラウザ対戦の観戦ID、または通信対戦中のプレイヤーIDに接続し、受信した操作ログを再生する。観戦同士で接続した場合は、先に接続した側がログ中継を担当する。 |

## 進行手順

1. **手順1: 先行決定** – プレイヤー名を入力し、ラジオボタンで先行を選択。
2. **手順2〜4: 作戦フェーズ** – 先行前期(3回)→後攻作戦(5回)→先行後期(2回)の順でユニット作成→配置。配置前ユニットが無い場合は入れ替えモードへ。
3. **手順5: 欠番** – 何も行わず手順6へ移行。
4. **手順6: サイコロ配置** – R1〜R3 へ銀×2・金×1 を順に配置。
5. **手順7〜16: 行動フェーズ** – 先行/後攻で以下を繰り返す。
   - エネルギー消費決定 (通常/作戦/起死回生)
   - アクション処理: サイコロを投げ、兵種別移動可能数を得てユニット移動。
   - 作戦・起死回生後は指定のサイコロ再配置。
   - 勝利判定。どちらかの兵種残数が 0 で敗北。

## サイコロ演出

- 銀/金ダイスの面には「剣(士)」、「魔(術師)」、「策(士)」を表示。
- ダイスが停止後、上向き面を解析し出目を決定。


## 行動種別

- **通常アクション**: R1 のサイコロでダイスロール。処理後 R2→R1, R3→R2, R1→R3 と移動。出目に応じてユニットを移動。
- **作戦アクション**: R1, R2 の2個で判定。両銀のときは次ラウンドで金を R1 に移動。出目に応じてユニット１つを移動。
- **起死回生**: 全サイコロを使用。結果に応じてサイコロ再配置を行う。出目に応じてユニッ2１つを移動。

## エネルギーと勝利条件

- 各プレイヤーは最大 3 のエネルギートークンを持つ。策士移動やユニット除外で増加。
- 策士/魔術師/剣士残数のいずれかが 0 になると即敗北。

## ログ機能

- 対戦の全操作はログとして記録される。`操作ログ` パネルの「ログのダウンロード」ボタンで JSON を保存でき、デバッグや観戦の記録として利用可能。
- 保存しておいた JSON ログは「ログのアップロード」で読み込み、`ログを再生` ボタンを押すことで当時の対戦進行を再現して鑑賞できる。通信対戦で接続した観戦者も同じ仕組みでログを受信し、途中から合流しても最新状態まで追体験できる。

---
このメモは仕様の抜粋です。詳細は実装 (`src/App.tsx` など) を参照してください。
