# ToDo / リファクタリング留意事項

- [x] **グリフォンの移動が敵を跳び越せない問題を改善する**
  - グリフォンは、移動範囲に敵・味方がいると、そこを跳び越せる仕様であるが、いまは味方は跳び越せるが、敵は跳び越せない問題がある。
- [x] **グリフォンの移動時に隣接する敵を排除できない問題を改善する。グリフォンは、隣接する敵を飛び越えてもよいし、隣接する敵を排除してもよいようにする**
  - グリフォンが敵は跳び越す処理を追加したときにたぶん作りこんだバグなのでなおす。
- [x] **ドラゴンの隣接マスに敵ユニットあるいは味方ユニットがある場合にも、その先のマスに移動できてしまう問題を改善する**
  - ドラゴンは移動時に敵や味方があると、その先に進めない。
- [x] **複数ダイスを振った作戦アクション、起死回生アクションでダイスで出た値だけ動けない場合がある問題を改善する**
  - [x] ただし、同じコマを2回動かすことはできない
  - [x] すなわち、動かせる駒がない場合、行動数が余っていても終わりにする。
  - [x] なお、起死回生アクションでは3個のダイスのうち、2個を選ぶ
- [x] **作戦アクションの移動可能数のルールご理解を修正**
  - 作戦アクションでは2個のダイスのうち1個を選ぶ
- [x] **勝利演出の改善**
  - 満たした勝利条件を表示/「敵策士を捕らえた」「すべての敵魔術師を盤面から追い出した」「すべての敵剣士を無力化した」など
- [ ] **ユニット選択時と移動時の効果音の調整**
  - [ ] ユニット選択時は、ユニット/ダイス配置の効果音にする(今は移動音)
  - [ ] ユニットの移動時に、移動用の効果音を鳴らす(今は無音)
- [ ] **ゲームボードの表示の改善**
  - [x] 最大横幅を設定し、下に出っ張らないようにする
  - [x] ダイス置き場は上にする
  - [ ] 操作待ちの領域は背景の色などを変えて目立たせる。
  - [x] ユニット作成用カードは作成終了後は非表示にする
  - [x] 現在手番になっているプレイヤーの情報表示領域は色を変える
- [ ] **モーダルウィンドウを閉じる条件の追加**
  - モーダルウィンドウを表示時は、モーダルウィンドウ以外のグレーアウト部分をクリックするとcloseボタンを押したのと同様の動きをするようにする。
- [ ] **ユニット表現の改善**
  - ドラゴン、グリフォン、ユニコーンと剣士と魔術師と策士のアイコン画像を作成し、それを表示する
- [ ] **ゲームボードの改善**
  - コロセウム風の背景を設定する
- [ ] **サイコロ置き場の初期設定の改善**
  - クリックする位置を目立たせるよう、色変えする
- [ ] **サイコロ置き場の表現の改善**
  - 実際にサイコロを置く
- [ ] **DiceRollerOverlay の責務分離**
  - 現在は描画・物理設定・結果集計を一つのコンポーネントで担っている。`DiceMesh` のロジックを専用フックに抽出し、テストしやすい形にする。
- [x] **状態管理の整理**
  - `App.tsx` が巨大化している。ゲーム進行ステート／UIモーダル制御／デバッグ設定をカスタムフックや Zustand などのストアに分離する。
- [ ] **ユニット移動ロジックの共通化**
  - 各兵種の移動処理 (通常/グリフォン/ユニコーン) を専用モジュールに切り出し、テーブルデータで定義する。
- [ ] **テストの追加**
  - 仕様が複雑なため、手順ごとの E2E テスト（Playwright 等）と、計算ロジックのユニットテストを追加する。
- [ ] **アクセシビリティ**
  - モーダルのフォーカス制御、キーボード操作サポート、ARIA 属性の追加を検討する。
- [ ] **ドキュメント整備**
  - 仕様メモや関数リファレンスを継続的に更新し、PR 時に差分確認できるようにする。
- [ ] **デバッグ情報の表示を隠せるようにする**
  - とくにnextActionsを監視のために表示しているので、完成前には何とかする。