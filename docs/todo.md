# ToDo / リファクタリング留意事項

- [x] **グリフォンの移動が敵を跳び越せない問題を改善する**
  - グリフォンは、移動範囲に敵・味方がいると、そこを跳び越せる仕様であるが、いまは味方は跳び越せるが、敵は跳び越せない問題がある。
- [x] **グリフォンの移動時に隣接する敵を排除できない問題を改善する。グリフォンは、隣接する敵を飛び越えてもよいし、隣接する敵を排除してもよいようにする**
  - グリフォンが敵は跳び越す処理を追加したときにたぶん作りこんだバグなのでなおす。
- [x] **ドラゴンの隣接マスに敵ユニットあるいは味方ユニットがある場合にも、その先のマスに移動できてしまう問題を改善する**
  - ドラゴンは移動時に敵や味方があると、その先に進めない。
- [ ] **複数ダイスを振った作戦アクション、起死回生アクションでダイスで出た値だけ動けない場合がある問題を改善する**
  - ただし、同じコマを2回動かすことはできない
  - すなわち、動かせる駒がない場合、行動数が余っていても終わりにする。
  - なお、起死回生アクションでは3個のダイスのうち、2個を選ぶ
- [ ] **DiceRollerOverlay の責務分離**
  - 現在は描画・物理設定・結果集計を一つのコンポーネントで担っている。`DiceMesh` のロジックを専用フックに抽出し、テストしやすい形にする。
- [x] **状態管理の整理**
  - `App.tsx` が巨大化している。ゲーム進行ステート／UIモーダル制御／デバッグ設定をカスタムフックや Zustand などのストアに分離する。
- [ ] **ユニット移動ロジックの共通化**
  - 各兵種の移動処理 (通常/グリフォン/ユニコーン) を専用モジュールに切り出し、テーブルデータで定義する。
- [ ] **テストの追加**
  - 仕様が複雑なため、手順ごとの E2E テスト（Playwright 等）と、計算ロジックのユニットテストを追加する。
- [ ] **アクセシビリティ**
  - モーダルのフォーカス制御、キーボード操作サポート、ARIA 属性の追加を検討する。
- [ ] **ドキュメント整備**
  - 仕様メモや関数リファレンスを継続的に更新し、PR 時に差分確認できるようにする。
- [ ] **デバッグ情報の表示を隠せるようにする**
  - とくにnextActionsを監視のために表示しているので、完成前には何とかする。